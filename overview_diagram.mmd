classDiagram
    %% UI Components (blå)
    class MainWindow {
        +db_path: str
        +stacked_widget: QStackedWidget
        +pages: dict
        +navigation_manager: NavigationManager
        +event_manager: EventManager
        +assignment_manager: AssignmentManager
        +create_pages()
        +_populate_stacked_widget()
        +create_home_page()
        +_initialize_ui_elements()
        +display_page()
    }
    class CreateAssignmentDialog {
        -main_window: MainWindow
        -manager: AssignmentManager
        -event_manager: EventManager
        +submit()
    }
    class ListAssign {
        -main_window: MainWindow
        -assignment_manager: AssignmentManager
        -event_manager: EventManager
        -assignment: Assignment
        -title_label: QLabel
        -assignment_tree: AssignmentTree
        -delete_button: QPushButton
        +init_ui(assignment: Assignment)
        +populate_assignments()
        +sort_assignments(assignments)
        +go_back()
        +delete_selected_assignment()
        +open_assign()
        +update_status()
    }
    class AssignmentTree {
        <<Widget>>
        +add_assignment(assignment: Assignment, today_date_str: str)
        +clear_tree()
    }
    class CustomButtons {
        <<Widget>>
        +create_button(label: str, callback)
        +create_button_grid(actions: list)
    }
    class SearchBar {
        <<Widget>>
        +search_result_label: QLabel
        +perform_search()
    }

    %% Managers and Handlers (grön)
    class NavigationManager {
        -main_window: MainWindow
        +display_page(page_name: str)
        +create_menus()
    }
    class AssignmentManager {
        -db_path: str
        -event_manager: EventManager
        +create_assignment(kommun: str, adress: str, ort: str, material: str, tomningsfrekvens: str, info: str, chauffor: str, koordinater: str)
        +insert_assignment(assignment: Assignment)
        +fetch_assignments()
        +fetch_assignments_sorted_by_date()
        +get_assignments_for_current_week()
        +update_job_status(assignment_id: int, status: str, image_path: str)
        +delete_assignment(assignment_id: int)
        +fetch_assignment_by_id(assignment_id: int)
        +log_assignment_creation(assignment: Assignment)
    }
    class EventManager {
        +insert_assignment(assignment: Assignment)
        +setup_handlers()
        +handle_assignment_completed(assignment: Assignment)
        +log_assignment_creation(assignment: Assignment)
        +notify_user(assignment: Assignment)
    }
    class RecurrenceManager {
        -db_path: str
        +create_recurring_assignment(assignment: Assignment, recurrence_interval_days: int, event_manager: EventManager)
    }
    class EventHandler {
        +register_handler(event_name: str, handler: Callable)
        +trigger_event(event_name, *args, **kwargs)
    }

    %% Data and Utility Functions (orange)
    class Assignment {
        +kommun: str
        +adress: str
        +ort: str
        +material: str
        +tomningsfrekvens: str
        +info: str
        +chauffor: str
        +koordinater: str
        +status: str
        +senast_hamtad: str
        +image_path: str
        +next_occurrence_date: datetime
    }
    class Connection {
        <<Function>>
        +get_db_connection(db_path: str)
    }
    class AssignmentQueries {
        <<Query>>
        +CREATE_ASSIGNMENTS_TABLE
        +INSERT_ASSIGNMENT
        +INSERT_RECURRING_ASSIGNMENT
        +UPDATE_JOB_STATUS
        +DELETE_ASSIGNMENT
        +SELECT_ALL_ASSIGNMENTS
        +SELECT_ASSIGNMENTS_SORTED_BY_DATE
        +SELECT_ASSIGNMENTS_FOR_CURRENT_WEEK
        +SELECT_ASSIGNMENT_BY_ID
    }
    class FileUtils {
        <<Function>>
        +save_file(file_path: str, destination_dir: str)
        +delete_file(file_path: str)
        +read_file(file_path: str)
    }
    class RecurringDatesUtils {
        <<Function>>
        +next_monday(current_date: datetime)
        +next_tuesday(current_date: datetime)
        +next_wednesday(current_date: datetime)
        +next_thursday(current_date: datetime)
        +next_friday(current_date: datetime)
        +next_saturday(current_date: datetime)
        +next_sunday(current_date: datetime)
        +next_valfri(current_date: datetime)
        +next_veckotvilling(current_date: datetime)
        +next_even_week(current_date: datetime)
        +next_odd_week(current_date: datetime)
        +next_every_x_weeks(current_date: datetime, x: int)
        +next_first_thursday(current_date: datetime)
        +next_25th_day(current_date: datetime)
        +calculate_next_date(tomningsfrekvens: str, current_date: datetime)
    }
    class DataValidation {
        <<Function>>
        +validate_recurring_frequency(tomningsfrekvens: str)
    }

    %% System Core (röd)
    class RootMain {
        +main()
    }
    class DBManager {
        +init_db()
    }
    class Config {
        +DB_PATH: str
    }

    %% Relations
    MainWindow --> NavigationManager
    MainWindow --> EventManager
    MainWindow --> AssignmentManager
    MainWindow --> ListAssign
    MainWindow --> CreateAssignmentDialog
    NavigationManager --> MainWindow
    RecurrenceManager --> Assignment
    RecurrenceManager --> EventManager
    CreateAssignmentDialog --> MainWindow
    CreateAssignmentDialog --> AssignmentManager
    CreateAssignmentDialog --> EventManager
    ListAssign --> MainWindow
    ListAssign --> AssignmentManager
    ListAssign --> EventManager
    ListAssign --> AssignmentTree
    CustomButtons --> MainWindow
    SearchBar --> MainWindow
    AssignmentManager --> Connection
    EventManager --> Connection
    RecurrenceManager --> Connection
    CreateAssignmentDialog --> Connection
    ListAssign --> Connection
    AssignmentManager --> AssignmentQueries
    EventManager --> AssignmentQueries
    RecurrenceManager --> AssignmentQueries
    CreateAssignmentDialog --> AssignmentQueries
    ListAssign --> AssignmentQueries
    RootMain --> MainWindow
    RootMain --> DBManager
    RootMain --> EventManager
    RootMain --> RecurrenceManager
    RootMain --> AssignmentManager
    Config --> RootMain
    Config --> DBManager
    FileUtils --> Connection
    RecurringDatesUtils --> Connection
    DataValidation --> Connection

